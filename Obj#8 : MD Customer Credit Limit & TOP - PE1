SELECT
    CC.CREDIT_CONTROL_AREA,
    SO.PLANT || '-' || CP.PLANT_NAME AS PLANT,
    REG.REGION || '-' || REG.REGION_DESC AS REGION,
    CASE 
        WHEN REG.REGION IN ('01', '02', '03', '04', '05', '28') THEN 'Pulau Jawa'
        ELSE 'Luar Jawa'
    END AS STATUS_REGION,
    SA.DISTRIBUTION_CHANNEL ||'-'|| SA.DISTRIBUTION_CHANNEL_DESC AS DISTRIBUTION_CHANNEL,
    CC.CREDIT_OWNER,
    CC.CREDIT_OWNER_NAME,
    CC.CUSTOMER,
    CC.CUSTOMER_NAME,
    CC.CREDIT_LIMIT,
    CUST.TERM_OF_PAYMENT,
    CUST.TERM_OF_PAYMENT_DESC,
    CUST.CUSTOMER_GROUP ||'-'|| CUST.CUSTOMER_GROUP_DESC AS CUSTOMER_GROUP,
    CASE
        WHEN CC.CREDIT_LIMIT < 3000000 THEN '1/ <3 juta'
        WHEN CC.CREDIT_LIMIT >= 3000000 AND CC.CREDIT_LIMIT <= 30000000 THEN '2/ 3-30 juta'
        WHEN CC.CREDIT_LIMIT > 30000000 AND CC.CREDIT_LIMIT <= 100000000 THEN '3/ 30-100 juta'
        WHEN CC.CREDIT_LIMIT > 100000000 AND CC.CREDIT_LIMIT <= 500000000 THEN '4/ 100-500 juta'
        WHEN CC.CREDIT_LIMIT > 500000000 AND CC.CREDIT_LIMIT <= 1000000000 THEN '5/ 500 juta - 1M'
        WHEN CC.CREDIT_LIMIT > 1000000000 THEN '6/ > 1 M'
        ELSE 'Unknown'
    END AS CREDIT_LIMIT_GROUP,
    CASE 
        WHEN COUNT(DISTINCT C2.DISTRIBUTION_CHANNEL) > 1 THEN 'TRUE'
        ELSE 'FALSE'
    END AS MULTIPLE_DISTRIBUTION_CHANNEL,
    CUST.BLOCK_FOR_SALES,
    CUST.DELETION_FOR_SALES 
FROM PROD_DB.DSTR_BI_COMMUNITY.D_SALES_CUSTOMER_CREDIT CC
LEFT JOIN PROD_DB.DSTR_BI_COMMUNITY.F_SALES_SALES_ORDER SO
    ON CC.CUSTOMER = SO.CUSTOMER
    AND CC.SOURCE_SYSTEM = SO.SOURCE_SYSTEM
LEFT JOIN PROD_DB.DSTR_BI_COMMUNITY.D_SALES_CUSTOMER CUST
    ON CC.CUSTOMER = CUST.CUSTOMER
    AND CC.SOURCE_SYSTEM = CUST.SOURCE_SYSTEM
LEFT JOIN PROD_DB.DSTR_BI_COMMUNITY.D_SALES_AREA SA
    ON CUST.SOURCE_SYSTEM = SA.SOURCE_SYSTEM 
    AND CUST.DISTRIBUTION_CHANNEL = SA.DISTRIBUTION_CHANNEL
LEFT JOIN PROD_DB.DSTR_BI_COMMUNITY.D_SALES_REGION REG
    ON CUST.REGION = REG.REGION
    AND CUST.SOURCE_SYSTEM = REG.SOURCE_SYSTEM
LEFT JOIN PROD_DB.DSTR_BI_COMMUNITY.D_SCM_COMPANY_AND_PLANT CP
    ON SO.SOURCE_SYSTEM = CP.SOURCE_SYSTEM
    AND SO.COMPANY_CODE = CP.COMPANY_CODE
    AND SO.PLANT = CP.PLANT
LEFT JOIN PROD_DB.DSTR_BI_COMMUNITY.D_SALES_CUSTOMER C2
    ON CC.CUSTOMER = C2.CUSTOMER
    AND CC.SOURCE_SYSTEM = C2.SOURCE_SYSTEM
LEFT JOIN PROD_DB.DSTR_BI_COMMUNITY.F_FINANCE_AR_AGING_CUSTOMER_CURRENT AR
    ON CC.CUSTOMER_NAME = AR.CUSTOMER_NAME
    AND CC.SOURCE_SYSTEM = AR.SOURCE_SYSTEM
WHERE 
    CC.SOURCE_SYSTEM = 'PE1'
    AND SO.COMPANY_CODE = 'ID90'
    AND REG.COUNTRY = 'ID'
GROUP BY 
    CC.CREDIT_CONTROL_AREA,
    SO.PLANT,
    CP.PLANT_NAME,
    REG.REGION,
    REG.REGION_DESC,
    SA.DISTRIBUTION_CHANNEL,
    SA.DISTRIBUTION_CHANNEL_DESC,
    CC.CREDIT_OWNER,
    CC.CREDIT_OWNER_NAME,
    CC.CUSTOMER,
    CC.CUSTOMER_NAME,
    CC.CREDIT_LIMIT,
    CUST.TERM_OF_PAYMENT,
    CUST.BLOCK_FOR_SALES,
    CUST.DELETION_FOR_SALES,
    CUST.TERM_OF_PAYMENT_DESC, 
	CUST.CUSTOMER_GROUP,
	CUST.CUSTOMER_GROUP_DESC ;

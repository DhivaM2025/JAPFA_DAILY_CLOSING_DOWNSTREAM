-- SO CPP --
(SELECT 
	Z.SALES_ORDER_EXTERNAL_DOCUMENT,
	Y.SOURCE_SYSTEM,
	Y.COMPANY_CODE, 
	CP.PLANT || '-' || CP.PLANT_NAME AS PLANT,
	TRY_TO_DATE (Y.SALES_ORDER_CREATED_DATE, 'YYYYMMDD') AS SO_CREATED_DATE,
	Y.CUSTOMER || '-' || CUST.CUSTOMER_NAME AS CUSTOMER,  
	C1.DISTRIBUTION_CHANNEL || '-' || SA.DISTRIBUTION_CHANNEL_DESC AS DISTRIBUTION_CHANNEL,
	CUST.REGION || '-' || REG.REGION_DESC AS REGION,
  	CASE 
		WHEN CUST.REGION IN ('01', '02', '03', '04', '05', '28') THEN 'PULAU JAWA'
	ELSE 'LUAR JAWA'
	END AS STATUS_REGION,
	X.*,
	NULL AS PO_NUMBER,
	NULL AS INV_NUMBER,
	FROM
((SELECT 
	'Sales Order' AS CATEGORY, 
	SALES_ORDER_TYPE || '-' || SALES_ORDER_TYPE_DESC AS TYPE,
	CASE 
    	WHEN SALES_ORDER_STATUS IS NULL OR SALES_ORDER_STATUS_DESC IS NULL THEN SALES_ORDER_STATUS_DESC 
    	ELSE SALES_ORDER_STATUS || '-' || SALES_ORDER_STATUS_DESC 
	END AS SALES_ORDER_STATUS,
	SALES_ORDER_STATUS_REJECTION || '-' || SALES_ORDER_STATUS_REJECTION_DESC AS STATUS_REJECTION,
	SALES_ORDER_NUMBER, 
	NULL AS DELIVERY_NUMBER, 
	NULL AS BILLING_NUMBER, 
	TRY_TO_DATE (SALES_ORDER_CREATED_DATE, 'YYYYMMDD') AS CREATED_DATE, 
	SUM(SALES_ORDER_NEGATIVE_FLAG * SALES_ORDER_QUANTITY_IN_KG) AS SO_QTY, 
	SUM (SALES_ORDER_NEGATIVE_FLAG * SALES_ORDER_NET_AMOUNT) AS SO_AMOUNT,
	0 AS DO_QTY, 
	0 AS BILL_QTY,
	0 AS BILL_AMOUNT,
	NULL AS BILLING_CLEAR_FLAG
FROM PROD_DB.DSTR_BI_COMMUNITY.F_SALES_SALES_ORDER
WHERE SALES_ORDER_TYPE = 'ZKS2'
	AND CUSTOMER = 'JID90HA000'
	AND SALES_ORDER_NUMBER = '1704892589'
GROUP BY ALL)
UNION ALL
(SELECT 
	'Delivery Order' AS CATEGORY, 
	DELIVERY_TYPE || '-' || DELIVERY_TYPE_DESC AS TYPE,
	CASE 
    	WHEN SO.SALES_ORDER_STATUS_DELIVERY IS NULL OR SO.SALES_ORDER_STATUS_DELIVERY_DESC IS NULL
    	THEN SO.SALES_ORDER_STATUS_DELIVERY_DESC
    	ELSE SO.SALES_ORDER_STATUS_DELIVERY || '-' || SO.SALES_ORDER_STATUS_DELIVERY_DESC
    END AS STATUS,
	NULL AS STATUS_REJECTION,
	REFERENCE_SALES_ORDER_NUMBER, 
	DELIVERY_NUMBER, 
	NULL AS BILLING_NUMBER, 
	TRY_TO_DATE (DELIVERY_CREATED_DATE, 'YYYYMMDD') AS CREATED_DATE, 
	0 AS SO_QTY, 
	0 AS SO_AMOUNT,
	SUM(DELIVERY_QUANTITY_IN_KG) AS DO_QTY,
	0 AS BILL_QTY,
	0 AS BILL_AMOUNT,
	NULL AS BILLING_CLEAR_FLAG
FROM PROD_DB.DSTR_BI_COMMUNITY.F_SALES_DELIVERY SD
LEFT JOIN 
	(SELECT DISTINCT SALES_ORDER_NUMBER, SALES_ORDER_STATUS_DELIVERY, SALES_ORDER_STATUS_DELIVERY_DESC, SALES_ORDER_TYPE FROM PROD_DB.DSTR_BI_COMMUNITY.F_SALES_SALES_ORDER) AS SO
	ON SD.REFERENCE_SALES_ORDER_NUMBER  = SO.SALES_ORDER_NUMBER
	AND SALES_ORDER_TYPE = 'ZKS2'
WHERE SO.SALES_ORDER_TYPE = 'ZKS2'
	AND CUSTOMER = 'JID90HA000'
	AND SO.SALES_ORDER_NUMBER = '1704892589'
GROUP BY ALL)
UNION ALL
(SELECT 'Billing' AS Category, 
	BILLING_TYPE || '-' || BILLING_TYPE_DESC AS TYPE,
	CASE 
    	WHEN SO.SALES_ORDER_STATUS_BILLING_DESC IS NULL OR SO.SALES_ORDER_STATUS_BILLING = '' 
    	THEN SO.SALES_ORDER_STATUS_BILLING_DESC
    	ELSE SO.SALES_ORDER_STATUS_BILLING || '-' || SO.SALES_ORDER_STATUS_BILLING_DESC
    END AS STATUS,
	NULL AS STATUS_REJECTION,
	REFERENCE_SALES_ORDER_NUMBER, 
	NULL AS DELIVERY_NUMBER, 
	SB.BILLING_NUMBER, 
	TRY_TO_DATE (BILLING_CREATED_DATE, 'YYYYMMDD') AS CREATED_DATE,
	0 AS SO_QTY, 
	0 AS SO_AMOUNT,
	0 AS DO_QTY,
	SUM (BILLING_NEGATIVE_FLAG * BILLING_QUANTITY_IN_KG) AS BILL_QTY,
	SUM (BILLING_NEGATIVE_FLAG * BILLING_NET_AMOUNT) AS BILL_AMOUNT,
	CASE 
        WHEN SBC.BILLING_CLEARING_DOC IS NOT NULL THEN 'X'
        ELSE NULL
    END AS BILLING_CLEAR_FLAG
FROM PROD_DB.DSTR_BI_COMMUNITY.F_SALES_BILLING AS SB
LEFT JOIN 
	(SELECT DISTINCT SALES_ORDER_NUMBER, SALES_ORDER_STATUS_BILLING, SALES_ORDER_STATUS_BILLING_DESC, SALES_ORDER_TYPE FROM PROD_DB.DSTR_BI_COMMUNITY.F_SALES_SALES_ORDER) AS SO
	ON SB.REFERENCE_SALES_ORDER_NUMBER = SO.SALES_ORDER_NUMBER
	AND SALES_ORDER_TYPE = 'ZKS2'
LEFT JOIN 
	(SELECT DISTINCT SOURCE_SYSTEM, BILLING_NUMBER, BILLING_CLEARING_DOC FROM PROD_DB.DSTR_BI_COMMUNITY.F_SALES_BILLING_CLEARING) AS SBC
	ON SB.SOURCE_SYSTEM = SBC.SOURCE_SYSTEM
	AND SB.BILLING_NUMBER = SBC.BILLING_NUMBER
WHERE SO.SALES_ORDER_TYPE = 'ZKS2'
	AND CUSTOMER = 'JID90HA000'
	AND REFERENCE_SALES_ORDER_NUMBER = '1704892589'
GROUP BY ALL)) X
LEFT JOIN 
	(SELECT DISTINCT SALES_ORDER_CREATED_DATE, SOURCE_SYSTEM, COMPANY_CODE, PLANT, CUSTOMER, SALES_ORDER_NUMBER, DISTRIBUTION_CHANNEL FROM PROD_DB.DSTR_BI_COMMUNITY.F_SALES_SALES_ORDER) AS Y 
	ON X.SALES_ORDER_NUMBER = Y.SALES_ORDER_NUMBER
LEFT JOIN 
	(SELECT DISTINCT SOURCE_SYSTEM, CUSTOMER, CUSTOMER_NAME, REGION FROM PROD_DB.DSTR_BI_COMMUNITY.D_SALES_CUSTOMER) AS CUST
	ON Y.CUSTOMER = CUST.CUSTOMER
	AND Y.SOURCE_SYSTEM = CUST.SOURCE_SYSTEM
LEFT JOIN 
	(SELECT DISTINCT SOURCE_SYSTEM, CUSTOMER, DISTRIBUTION_CHANNEL FROM PROD_DB.DSTR_BI_COMMUNITY.D_SALES_CUSTOMER) AS C1
	ON Y.SOURCE_SYSTEM = C1.SOURCE_SYSTEM
	AND Y.CUSTOMER = C1.CUSTOMER
	AND Y.DISTRIBUTION_CHANNEL = C1.DISTRIBUTION_CHANNEL
LEFT JOIN 
	(SELECT DISTINCT SOURCE_SYSTEM, COMPANY_CODE, COMPANY_NAME, PLANT, PLANT_NAME FROM PROD_DB.DSTR_BI_COMMUNITY.D_SCM_COMPANY_AND_PLANT CP) AS CP
	ON Y.COMPANY_CODE = CP.COMPANY_CODE
	AND Y.PLANT = CP.PLANT
	AND Y.SOURCE_SYSTEM = CP.SOURCE_SYSTEM
LEFT JOIN
	(SELECT DISTINCT SOURCE_SYSTEM, DISTRIBUTION_CHANNEL, DISTRIBUTION_CHANNEL_DESC FROM PROD_DB.DSTR_BI_COMMUNITY.D_SALES_AREA) AS SA
	ON C1.SOURCE_SYSTEM = SA.SOURCE_SYSTEM
	AND C1.DISTRIBUTION_CHANNEL = SA.DISTRIBUTION_CHANNEL
LEFT JOIN
	(SELECT DISTINCT SOURCE_SYSTEM, REGION, REGION_DESC, COUNTRY FROM PROD_DB.DSTR_BI_COMMUNITY.D_SALES_REGION) AS REG
    ON CUST.SOURCE_SYSTEM = REG.SOURCE_SYSTEM
	AND CUST.REGION = REG.REGION
    AND REG.COUNTRY = 'ID'
LEFT JOIN
	(SELECT DISTINCT SALES_ORDER_NUMBER, SALES_ORDER_EXTERNAL_DOCUMENT FROM /*PROD_DB.DSTR_BI_COMMUNITY.F_SALES_INTERCO_HEADER*/ temp_header_interco) AS Z
	ON X.SALES_ORDER_NUMBER = Z.SALES_ORDER_NUMBER)	
-- PO SGF --
UNION ALL
(SELECT 
	NULL AS SALES_ORDER_EXTERNAL_DOCUMENT,
	SOURCE_SYSTEM,
	NULL AS COMPANY,
	NULL PLANT,
	NULL AS SO_CREATED_DATE,
    NULL AS CUSTOMER,
    NULL AS DISTRIBUTION_CHANNEL,
    NULL AS REGION,
    NULL AS STATUS_REGION,
	CATEGORY,
	NULL AS "TYPE",
	NULL AS SALES_ORDER_STATUS,	
	NULL AS STATUS_REJECTION,
	Z.SALES_ORDER_NUMBER AS SALES_ORDER_NUMBER,
	NULL AS DELIVERY_NUMBER,
	NULL AS BILLING_NUMBER,
	NULL AS CREATED_DATE,
	NULL AS SO_QTY,
	NULL AS SO_AMOUNT,
	NULL AS DO_QTY,
	NULL AS BILL_QTY,
	NULL AS BILL_AMOUNT,
	NULL AS BILLING_CLEAR_FLAG,
	PO_NUMBER,
	INV_NUMBER,
FROM
((SELECT DISTINCT
	'Purchase Order' AS CATEGORY,
	SOURCE_SYSTEM,
	PO.PURCHASE_ORDER AS PO_NUMBER,
	NULL AS INV_NUMBER,
	INT.SALES_ORDER_NUMBER
FROM /*F_SCM_PURCHASING_ORDER*/ temp_purchasing PO
LEFT JOIN 
	(SELECT DISTINCT SALES_ORDER_NUMBER, SALES_ORDER_EXTERNAL_DOCUMENT, PO_NUM_FUL FROM /*PROD_DB.DSTR_BI_COMMUNITY.F_SALES_INTERCO_HEADER*/ temp_header_interco) AS INT
	ON PO.PURCHASE_ORDER = INT.PO_NUM_FUL
WHERE DOCUMENT_NUMBER = '5000520423' AND SALES_ORDER_NUMBER = '1207311320'
GROUP BY ALL)
UNION ALL
(SELECT DISTINCT
	'Invoice' AS CATEGORY,
	SOURCE_SYSTEM,
	PO.PURCHASE_ORDER AS PO_NUMBER,
	DOCUMENT_NUMBER AS INV_NUMBER,
	INT.SALES_ORDER_NUMBER
FROM /*F_SCM_PURCHASING_ORDER*/ temp_purchasing PO
LEFT JOIN 
	(SELECT DISTINCT SALES_ORDER_NUMBER, SALES_ORDER_EXTERNAL_DOCUMENT, PO_NUM_FUL FROM /*PROD_DB.DSTR_BI_COMMUNITY.F_SALES_INTERCO_HEADER*/ temp_header_interco) AS INT
	ON PO.PURCHASE_ORDER = INT.PO_NUM_FUL
WHERE   DOCUMENT_NUMBER = '5000520423' AND SALES_ORDER_NUMBER = '1207311320'
GROUP BY ALL)) AS X
LEFT JOIN
	(SELECT DISTINCT SALES_ORDER_NUMBER, SALES_ORDER_EXTERNAL_DOCUMENT, PO_NUM_FUL FROM /*PROD_DB.DSTR_BI_COMMUNITY.F_SALES_INTERCO_HEADER*/ temp_header_interco) AS Z
	ON X.SALES_ORDER_NUMBER = Z.SALES_ORDER_EXTERNAL_DOCUMENT)

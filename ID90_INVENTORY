-- DASHBOARD #6 : INVENTORY - MOVEMENT TYPE, SLOC, BACKDATE

SELECT DISTINCT
	COMPANY_CODE,
	PLANT,
	PLANT_NAME,
	FISCAL_YEAR,
	PURCHASE_ORDER,
	BATCH,
--	MATERIAL_DOCUMENT_NUMBER,
--	TRY_TO_DATE(ENTRY_DATE, 'YYYYMMDD') AS ENTRY_DATE,
--	TRY_TO_DATE(POSTING_DATE, 'YYYYMMDD') AS POSTING_DATE,
--	TO_CHAR(TRY_TO_DATE(POSTING_DATE, 'YYYYMMDD'), 'Mon') AS POSTING_MONTH_NAME,
	STORAGE_LOCATION AS SLOC,
	STORAGE_LOCATION_NAME AS SLOC_DESC,
	MOVEMENT_TYPE,
	MOVEMENT_TYPE_DESCRIPTION,
	FROM_LOCATION,
	TO_LOCATION,
	BASE_UNIT_OF_MEASURE,
	CURRENCY,
	SPECIAL_STOCK,
	SUM(MUTASI_IN_QUANTITY) AS TOTAL_MUTASI_IN_QUANTITY,
	SUM(MUTASI_IN_AMOUNT) AS TOTAL_MUTASI_IN_AMOUNT,
	SUM(MUTASI_OUT_QUANTITY) AS TOTAL_MUTASI_OUT_QUANTITY,
	SUM(MUTASI_OUT_AMOUNT) AS TOTAL_MUTASI_OUT_AMOUNT,
	SUM(MUTASI_IN_QUANTITY) - SUM(MUTASI_OUT_QUANTITY) AS TOTAL_MUTASI_QTY,
	SUM(MUTASI_IN_AMOUNT) - SUM(MUTASI_OUT_AMOUNT) AS TOTAL_MUTASI_AMOUNT,
	-- Entry Flag
--	CASE 
--		WHEN TRY_TO_DATE(ENTRY_DATE, 'YYYYMMDD') IS NULL AND TRY_TO_DATE(POSTING_DATE, 'YYYYMMDD') IS NULL THEN 'Unknown'
--	    WHEN TRY_TO_DATE(ENTRY_DATE, 'YYYYMMDD') IS NOT NULL AND TRY_TO_DATE(POSTING_DATE, 'YYYYMMDD') IS NULL THEN 'Real-time entry'
--	    WHEN TRY_TO_DATE(ENTRY_DATE, 'YYYYMMDD') = TRY_TO_DATE(POSTING_DATE, 'YYYYMMDD') THEN 'Real-time entry'
--	    WHEN TRY_TO_DATE(POSTING_DATE, 'YYYYMMDD') > TRY_TO_DATE(ENTRY_DATE, 'YYYYMMDD') THEN 'Forward-dated entry'
--	    WHEN TRY_TO_DATE(POSTING_DATE, 'YYYYMMDD') < TRY_TO_DATE(ENTRY_DATE, 'YYYYMMDD') THEN 'Backdated entry'
--	    ELSE 'Backdated entry'
--	END AS INV_BACKDATE,
--	-- Backdate : Entry date - Posting date
--	CASE 
--	    WHEN TRY_TO_DATE(ENTRY_DATE, 'YYYYMMDD') IS NOT NULL AND TRY_TO_DATE(POSTING_DATE, 'YYYYMMDD') IS NOT NULL 
--	    THEN TO_VARCHAR(DATEDIFF(DAY, TRY_TO_DATE(ENTRY_DATE, 'YYYYMMDD'), TRY_TO_DATE(POSTING_DATE, 'YYYYMMDD')))
--		WHEN TRY_TO_DATE(ENTRY_DATE, 'YYYYMMDD') IS NOT NULL AND TRY_TO_DATE(POSTING_DATE, 'YYYYMMDD') IS NULL 
--	    THEN 'Belum Posting'
--	    ELSE 'Unknown'
--	END AS INV_DIFF_DAYS,
--	CASE 
--	    WHEN INV_DIFF_DAYS = 'Unknown' THEN 'Unknown'
--	    -- Nilai positif
--	    WHEN INV_DIFF_DAYS BETWEEN 0 AND 3 THEN '1/ 0-3 Hari'
--	    WHEN INV_DIFF_DAYS > 3 AND INV_DIFF_DAYS <= 7 THEN '2/ 3-7 Hari'
--	    WHEN INV_DIFF_DAYS > 7 AND INV_DIFF_DAYS <= 14 THEN '3/ 7-14 Hari'
--	    WHEN INV_DIFF_DAYS > 14 AND INV_DIFF_DAYS <= 30 THEN '4/ 14-30 Hari'
--	    WHEN INV_DIFF_DAYS > 30 THEN '5/ >30 Hari'
--	    -- Nilai negatif
--	    WHEN INV_DIFF_DAYS BETWEEN -3 AND -1 THEN '1/ 0-3 Hari'
--	    WHEN INV_DIFF_DAYS BETWEEN -7 AND -4 THEN '2/ 3-7 Hari'
--	    WHEN INV_DIFF_DAYS BETWEEN -14 AND -8 THEN '3/ 7-14 Hari'
--	    WHEN INV_DIFF_DAYS BETWEEN -30 AND -15 THEN '4/ 14-30 Hari'
--	    WHEN INV_DIFF_DAYS < -30 THEN '5/ >30 Hari'
--	    ELSE NULL
--	END AS AGING
FROM PROD_DB.DSTR_BI_COMMUNITY.F_SCM_MUTASI_MATERIAL 
	WHERE SOURCE_SYSTEM = 'PE1' 
	AND FISCAL_YEAR = '2025' 
--	AND ENTRY_DATE BETWEEN '20250601' AND CURRENT_DATE
GROUP BY ALL;
